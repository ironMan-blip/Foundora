
<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Search • Foundora</title>
  <link rel="shortcut icon" href="./favicon-32.png" type="image/x-icon">
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            ink: "#1B1532",
            plum: "#2B1E4A",
            softBlue: "#EAF4FF",
            mist: "#F6FAFF",
            mint: "#7BE0C3",
            cyanSoft: "#B6ECFF",
            lavender: "#C9C5FF",
            peach: "#FFD5C8",
          },
          fontFamily: {
            display: ["Poppins", "ui-sans-serif", "system-ui"],
            sans: ["Inter", "ui-sans-serif", "system-ui"],
          },
          boxShadow: {
            card: "0 14px 40px rgba(17, 12, 46, .10)",
            soft: "0 22px 70px rgba(17, 12, 46, .14)",
            glow: "0 18px 60px rgba(123,224,195,.32)",
          },
        },
      },
    };
  </script>

  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link
    href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&family=Poppins:wght@600;700;800&display=swap"
    rel="stylesheet"
  />

  <style>
    html { scroll-behavior: smooth; }
    .grain { position: relative; }
    .grain::before{
      content:"";
      position:absolute; inset:0;
      pointer-events:none;
      opacity:.06;
      background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='160' height='160'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='.9' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='160' height='160' filter='url(%23n)' opacity='.35'/%3E%3C/svg%3E");
      mix-blend-mode:multiply;
    }

    /* Floating motion (dashboard pages) */
    @keyframes floatY { 0%,100%{transform:translateY(0)} 50%{transform:translateY(-16px)} }
    @keyframes floatX { 0%,100%{transform:translateX(0)} 50%{transform:translateX(12px)} }
    @keyframes floatR { 0%,100%{transform:rotate(0) translateY(0)} 50%{transform:rotate(2deg) translateY(-10px)} }
    .float-slow { animation: floatY 8s ease-in-out infinite; }
    .float-mid  { animation: floatX 10s ease-in-out infinite; }
    .float-rot  { animation: floatR 12s ease-in-out infinite; }

    @media (prefers-reduced-motion: reduce) {
      html { scroll-behavior: auto; }
      .motion-safe\:animate-none { animation: none !important; }
      .float-slow,.float-mid,.float-rot { animation: none !important; }
    }
    .blob { border-radius: 62% 38% 55% 45% / 45% 55% 45% 55%; }
    .blob2 { border-radius: 55% 45% 40% 60% / 55% 45% 55% 45%; }
    .brush { position: relative; display: inline-block; z-index: 0; }
    .brush::after {
      content:"";
      position:absolute;
      left:-.06em; right:-.06em;
      bottom:.08em;
      height:.35em;
      border-radius:999px;
      background: linear-gradient(90deg, rgba(123,224,195,.95), rgba(182,236,255,.85));
      z-index:-1;
      transform: rotate(-1.2deg);
      filter: saturate(1.05);
    }
    .dash-circle { border-radius: 9999px; border: 2px dashed rgba(43, 30, 74, 0.22); }
    .reveal { opacity: 0; transform: translateY(14px); transition: 850ms ease; }
    .reveal.show { opacity: 1; transform: translateY(0); }
    .nav-link{ position: relative; padding-bottom: 6px; }
    .nav-link::after{
      content:""; position:absolute; left:0; bottom:0;
      width:0%; height:3px; background-color:#7BE3C6; border-radius:999px;
      transition: width .25s ease-in-out;
    }
    .nav-link:hover::after{ width:100%; }
  </style>
</head>
<body class="bg-white text-slate-800 font-sans antialiased">

  <div class="grain overflow-hidden relative min-h-screen">
    <div class="absolute inset-0 -z-10">
      <div class="absolute -top-36 -left-40 h-[520px] w-[520px] rounded-full blur-3xl opacity-30 float-slow"
        style="background: radial-gradient(circle at 35% 35%, #B6ECFF, transparent 60%);"></div>
      <div class="absolute -top-44 right-[-180px] h-[650px] w-[650px] rounded-full blur-3xl opacity-25 float-mid"
        style="background: radial-gradient(circle at 35% 35%, #7BE0C3, transparent 60%);"></div>
      <div class="absolute top-40 left-[45%] h-[520px] w-[520px] rounded-full blur-3xl opacity-18 float-rot"
        style="background: radial-gradient(circle at 35% 35%, #C9C5FF, transparent 60%);"></div>
    </div>

    <!-- TOP NAV -->
    <header class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 pt-6">
      <nav class="flex items-center justify-between">
        <div class="flex items-center gap-3">
          <a href="./index.html#home" class="inline-flex items-center gap-3">
            <img src="./logo.png" alt="Foundora" class="h-8 w-auto" />
            <span class="font-display font-extrabold text-plum tracking-tight text-lg hidden sm:inline">Foundora</span>
          </a>
        </div>

        <div class="hidden md:flex items-center gap-7 text-sm text-slate-700">
          <a class="hover:text-plum transition nav-link" href="./dashboard.html">Dashboard</a>
          <a class="hover:text-plum transition nav-link" href="./search.html">Search</a>
          <a class="hover:text-plum transition nav-link" href="./messages.html">Messages</a>
          <a class="hover:text-plum transition nav-link" href="./meetings.html">Meetings</a>
          <a class="hover:text-plum transition nav-link" href="./funding.html">Funding</a>
          <a class="hover:text-plum transition nav-link" href="./notifications.html">Alerts</a>
          <a class="hover:text-plum transition nav-link" href="./profile.html">Profile</a>
        </div>

        <div class="flex items-center gap-2">
          <div class="hidden sm:flex items-center gap-2 rounded-2xl border border-slate-200 bg-white/70 backdrop-blur px-3 py-2">
            <div class="h-8 w-8 rounded-xl bg-plum text-white grid place-items-center text-xs font-bold" id="userBadge">FD</div>
            <div class="leading-tight">
              <p class="text-[11px] font-semibold text-ink" id="userName">Guest</p>
              <p class="text-[10px] text-slate-500" id="userRole">—</p>
            </div>
          </div>

          <a id="btnBackToLanding" href="./index.html#home"
             class="hidden md:inline-flex items-center justify-center rounded-xl border border-slate-200 bg-white/70 backdrop-blur px-4 py-2 text-[11px] font-semibold tracking-wide text-slate-700 hover:bg-white transition">
            Landing
          </a>

          <button id="logoutBtn"
            class="inline-flex items-center justify-center rounded-xl bg-plum px-4 py-2 text-[11px] font-semibold tracking-wide text-white shadow-glow hover:-translate-y-[1px] transition">
            Logout
          </button>

          <button id="menuBtn" class="md:hidden rounded-xl border border-slate-200 px-3 py-2 bg-white/80 backdrop-blur" aria-label="Menu">
            <svg width="22" height="22" viewBox="0 0 24 24" fill="none">
              <path d="M4 7h16M4 12h16M4 17h16" stroke="#2B1E4A" stroke-width="2" stroke-linecap="round"/>
            </svg>
          </button>
        </div>
      </nav>

      <div id="mobileMenu" class="md:hidden hidden mt-4">
        <div class="rounded-2xl border border-slate-200 bg-white/80 backdrop-blur p-4 shadow-card">
          <div class="grid gap-3 text-sm font-medium">
            <a href="./dashboard.html" class="hover:text-plum">Dashboard</a>
            <a href="./search.html" class="hover:text-plum">Search</a>
            <a href="./messages.html" class="hover:text-plum">Messages</a>
            <a href="./meetings.html" class="hover:text-plum">Meetings</a>
            <a href="./funding.html" class="hover:text-plum">Funding</a>
            <a href="./notifications.html" class="hover:text-plum">Alerts</a>
            <a href="./profile.html" class="hover:text-plum">Profile</a></div>
        </div>
      </div>
    </header>

    <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 pt-10 pb-16">

<div class="reveal">
  <div class="rounded-3xl bg-white/80 backdrop-blur border border-slate-100 shadow-soft p-7">
    <h1 class="font-display text-3xl sm:text-4xl font-extrabold text-ink leading-tight">Search & <span class="brush">Filter</span></h1>
    <p class="mt-2 text-slate-600 text-sm leading-6 max-w-2xl">Find the right matches by industry, stage, location and verification.</p>

    <div class="mt-6 grid lg:grid-cols-4 gap-4">
      <div class="lg:col-span-1 rounded-3xl border border-slate-100 bg-mist p-5 shadow-card">
        <p class="text-xs font-extrabold text-ink">Filters</p>
        <label class="mt-4 grid gap-2">
          <span class="text-[11px] font-semibold text-slate-700" id="nameLabel">Search by name</span>
          <input id="nameQ" class="rounded-2xl border border-slate-200 bg-white px-4 py-3 text-sm outline-none focus:ring-2 focus:ring-plum/20" placeholder="Type a name..." />
        </label>

        <label class="mt-4 grid gap-2">
          <span class="text-[11px] font-semibold text-slate-700">Keyword</span>
          <input id="q" class="rounded-2xl border border-slate-200 bg-white px-4 py-3 text-sm outline-none focus:ring-2 focus:ring-plum/20" placeholder="SaaS, Fintech, Health..." />
        </label>
        <label class="mt-4 grid gap-2">
          <span class="text-[11px] font-semibold text-slate-700">Location</span>
          <input id="loc" class="rounded-2xl border border-slate-200 bg-white px-4 py-3 text-sm outline-none focus:ring-2 focus:ring-plum/20" placeholder="Dhaka, Dubai, NYC..." />
        </label>
<!-- Startup users can filter investors by ticket size -->
        <div id="ticketRange" class="mt-4 hidden">
          <p class="text-[11px] font-semibold text-slate-700">Investing amount range (USD)</p>
          <div class="mt-2 grid grid-cols-2 gap-2">
            <input id="minAmt" type="number" min="0" step="1000" class="rounded-2xl border border-slate-200 bg-white px-4 py-3 text-sm outline-none focus:ring-2 focus:ring-plum/20" placeholder="Min" />
            <input id="maxAmt" type="number" min="0" step="1000" class="rounded-2xl border border-slate-200 bg-white px-4 py-3 text-sm outline-none focus:ring-2 focus:ring-plum/20" placeholder="Max" />
          </div>
          <p class="mt-2 text-[10px] text-slate-500">Example: 25000 to 150000</p>
        </div>
        <button id="apply" class="mt-5 w-full inline-flex items-center justify-center rounded-2xl bg-plum px-6 py-3 text-xs font-semibold tracking-wide text-white shadow-glow hover:-translate-y-[1px] transition">Apply</button>
        <button id="reset" class="mt-3 w-full inline-flex items-center justify-center rounded-2xl border border-slate-200 bg-white/70 backdrop-blur px-6 py-3 text-xs font-semibold tracking-wide text-slate-700 hover:bg-white transition">Reset</button>
      </div>

      <div class="lg:col-span-3">
        <div class="flex items-center justify-between gap-3">
          <p class="text-xs text-slate-500" id="resultMeta">—</p>
          <div class="inline-flex rounded-2xl bg-slate-50 p-1 border border-slate-100">
            <button type="button" id="tabMatches" class="px-4 py-2 rounded-xl text-xs font-semibold text-white bg-plum transition">Matches</button>
            <button type="button" id="tabSaved" class="px-4 py-2 rounded-xl text-xs font-semibold text-slate-700 hover:bg-white transition">Saved</button>
          </div>
        </div>
        <div id="results" class="mt-4 grid sm:grid-cols-2 xl:grid-cols-3 gap-4"></div>
      </div>
    </div>
  </div>
</div>

    </main>

    <footer class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 pb-10">
      <div class="rounded-3xl border border-slate-100 bg-white/80 backdrop-blur shadow-card p-6 flex flex-col sm:flex-row items-center justify-between gap-3">
        <p class="text-xs text-slate-500">© <span id="year"></span> Foundora • Built for founders & investors</p>
        <div class="flex gap-4 text-xs">
          <a href="./index.html#contact" class="text-plum font-semibold hover:underline">Support</a>
          <a href="./index.html#about" class="text-plum font-semibold hover:underline">About</a>
          <a href="./index.html#services" class="text-plum font-semibold hover:underline">How it works</a>
        </div>
      </div>
    </footer>
  </div>

  <script src="./shared.js"></script>
  <script>
    // Mobile menu
    const menuBtn = document.getElementById("menuBtn");
    const mobileMenu = document.getElementById("mobileMenu");
    menuBtn?.addEventListener("click", () => mobileMenu.classList.toggle("hidden"));

    // Reveal
    const io = new IntersectionObserver(
      (entries) => entries.forEach(e => e.isIntersecting && e.target.classList.add("show")),
      { threshold: 0.14 }
    );
    document.querySelectorAll(".reveal").forEach(el => io.observe(el));

    // Year
    const y = document.getElementById("year");
    if (y) y.textContent = new Date().getFullYear();

    // Auth guard + top bar
    Foundora.requireAuth();
    Foundora.mountTopBar();

        Foundora.mountBubbles();
const user = Foundora.getUser();
    const data = Foundora.getData();
    // CHANGED: source is mutable; we will replace demo data with DB results from search_data.php
    let source = (user?.role === "investor") ? (data.startups||[]) : (data.investors||[]);
    let saved = new Set(JSON.parse(localStorage.getItem("foundora_saved")||"[]"));
    let mode = "matches";

    const tabMatches = document.getElementById("tabMatches");
    const tabSaved = document.getElementById("tabSaved");
    const results = document.getElementById("results");
    const meta = document.getElementById("resultMeta");

    // Role-based filter UI
    const nameLabel = document.getElementById("nameLabel");
    const ticketRange = document.getElementById("ticketRange");
    if ((user?.role || "startup") === "investor") {
      if (nameLabel) nameLabel.textContent = "Search startup by name";
      ticketRange?.classList.add("hidden");
    } else {
      if (nameLabel) nameLabel.textContent = "Search investor by name";
      ticketRange?.classList.remove("hidden");
    }

    const setTab = (m) => {
      mode = m;
      if (m === "matches") {
        tabMatches.classList.add("bg-plum","text-white"); tabMatches.classList.remove("text-slate-700");
        tabSaved.classList.remove("bg-plum","text-white"); tabSaved.classList.add("text-slate-700");
      } else {
        tabSaved.classList.add("bg-plum","text-white"); tabSaved.classList.remove("text-slate-700");
        tabMatches.classList.remove("bg-plum","text-white"); tabMatches.classList.add("text-slate-700");
      }
      render();
    };

    tabMatches.addEventListener("click", ()=>setTab("matches"));
    tabSaved.addEventListener("click", ()=>setTab("saved"));

    const parseMoney = (s) => {
      // "10k", "1M", "250000", "$50k" -> number
      const str = (s||"").toString().replace(/[^0-9kKmM.]/g, "");
      if (!str) return NaN;
      const m = str.match(/^([0-9]*\.?[0-9]+)([kKmM]?)$/);
      if (!m) return NaN;
      let n = parseFloat(m[1]);
      const suf = (m[2]||"").toLowerCase();
      if (suf === "k") n *= 1_000;
      if (suf === "m") n *= 1_000_000;
      return n;
    };

    const parseTicketRange = (ticket) => {
      // e.g. "$10k–$50k", "$250k–$1M"
      const t = (ticket||"").replace(/\s/g, "");
      const parts = t.split(/-|–|—/);
      const a = parseMoney(parts[0]);
      const b = parseMoney(parts[1] || parts[0]);
      return { min: isNaN(a) ? 0 : a, max: isNaN(b) ? 0 : b };
    };

    const applyFilters = () => {
      const nameQ = (document.getElementById("nameQ").value || "").toLowerCase();
      const q = (document.getElementById("q").value || "").toLowerCase();
      const loc = (document.getElementById("loc").value || "").toLowerCase();
      // CHANGED: removed verified filter UI
const minAmt = parseFloat(document.getElementById("minAmt")?.value || "");
      const maxAmt = parseFloat(document.getElementById("maxAmt")?.value || "");

      let items = source.slice();
      // CHANGED: removed verified-only filtering
// Name search (startup name for investors / investor name for startups)
      if (nameQ) items = items.filter(x => (x.name||"").toLowerCase().includes(nameQ));

      // General keyword search
      if (q) items = items.filter(x => JSON.stringify(x).toLowerCase().includes(q));
      if (loc) items = items.filter(x => (x.location||"").toLowerCase().includes(loc));

      // Startups searching investors can filter by investing amount range
      if ((user?.role || "startup") === "startup" && (!isNaN(minAmt) || !isNaN(maxAmt))) {
        items = items.filter(inv => {
          const r = parseTicketRange(inv.ticket);
          const min = isNaN(minAmt) ? 0 : minAmt;
          const max = isNaN(maxAmt) ? Number.POSITIVE_INFINITY : maxAmt;
          // overlap between [r.min, r.max] and [min, max]
          return r.max >= min && r.min <= max;
        });
      }
      return items;
    };

    const render = () => {
      results.innerHTML = "";
      let items = applyFilters();
      if (mode === "saved") items = items.filter(x => saved.has(x.id));

      meta.textContent = `${items.length} result(s) • Role: ${(user?.role||"startup").toUpperCase()}`;
      items.forEach(it => {
        const isSaved = saved.has(it.id);
        const el = document.createElement("article");
        el.className = "rounded-3xl border border-slate-100 bg-white/80 backdrop-blur shadow-card p-5 hover:-translate-y-[2px] hover:shadow-soft transition overflow-hidden";
        el.innerHTML = `
          <div class="flex items-start justify-between gap-3">
            <div>
              <p class="text-sm font-extrabold text-ink">${it.name}</p>
              <p class="mt-1 text-[11px] text-slate-600">${user?.role==="investor" ? (it.industry+" • "+it.stage+" • "+it.location) : (it.type+" • "+it.focus+" • "+it.location)}</p>
            </div>
            <div class="text-right"></div> <!-- CHANGED: removed verified + match percentage -->
          </div>
          <div class="mt-4 rounded-2xl bg-mist border border-slate-100 p-4">
            <p class="text-[11px] text-slate-600 leading-5">${user?.role==="investor" ? it.tagline : ("Ticket: "+it.ticket)}</p>
            ${user?.role==="investor" ? `<p class="mt-2 text-[11px] text-slate-500">Funding need: <span class="text-slate-700 font-semibold">$${(it.needs||0).toLocaleString()}</span></p>` : ``}
          </div>
          <div class="mt-4 flex items-center justify-between gap-3">
            <a href="./view_profile.php?id=${it.id}" class="text-xs font-semibold text-plum hover:underline">View profile</a> <!-- CHANGED -->
            <div class="flex gap-2">
              <button data-save="${it.id}" class="rounded-xl border border-slate-200 bg-white/70 px-3 py-2 text-[11px] font-semibold text-slate-700 hover:bg-white transition">${isSaved ? "Saved" : "Save"}</button>
              <button type="button" data-msg-id="${it.id}" data-msg-name="${it.name}" class="rounded-xl bg-plum px-3 py-2 text-[11px] font-semibold text-white shadow-glow hover:-translate-y-[1px] transition">Message</button>
            </div>
          </div>
        `;
        results.appendChild(el);
      });

      results.querySelectorAll("[data-save]").forEach(btn => {
        btn.addEventListener("click", () => {
          const id = btn.getAttribute("data-save");
          if (saved.has(id)) saved.delete(id); else saved.add(id);
          localStorage.setItem("foundora_saved", JSON.stringify([...saved]));
          render();
        });
      });

      results.querySelectorAll("[data-msg-id]").forEach(btn => {
        btn.addEventListener("click", () => {
          const id = btn.getAttribute("data-msg-id");
          const name = btn.getAttribute("data-msg-name");
          Foundora.startChat({ id, with: name });
        });
      });
    };

    document.getElementById("apply").addEventListener("click", render);
    document.getElementById("reset").addEventListener("click", () => {
      const nameQ = document.getElementById("nameQ");
      const minAmt = document.getElementById("minAmt");
      const maxAmt = document.getElementById("maxAmt");
      if (nameQ) nameQ.value = "";
      if (minAmt) minAmt.value = "";
      if (maxAmt) maxAmt.value = "";
      document.getElementById("q").value = "";
      document.getElementById("loc").value = "";
      // CHANGED: removed verified reset (filter removed)
setTab("matches");
    });
    render();

    // CHANGED: load search results from DB (replaces demo source after page loads)
    (async () => {
      try {
        const res = await fetch("./search_data.php", { credentials: "same-origin" });
        const json = await res.json();
        if (json && json.ok && Array.isArray(json.items)) {
          source = json.items;
          render(); // re-render with DB data
        } else {
          console.warn("search_data.php returned unexpected response", json);
        }
      } catch (e) {
        console.error("Failed to load search data from DB", e);
      }
    })();

  </script>
</body>
</html>
